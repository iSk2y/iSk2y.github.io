---
title: 一次小爬虫的分析记录
date: 2019-05-25 00:07:38
tags:
---



## 由来

有个朋友因为懒，又想收集一下数据自己分析，然后找我看能不能做成web的形式。于是信息搜集这部分我觉得采用Python来编写较合适。



## 分析目标

我需要抓取的是几个数字，但它并不是在访问的页面源代码中就存在的

![1558797631(1).jpg](https://i.loli.net/2019/05/25/5ce95d5f8420359322.jpg)

需要先点击左上方的第二个tab。再点击下面第五个tab才是我需要的这些内容。



原本我想索性直接上 selenium吧，后来想先用requests尝试下能否解决，那就开始吧？！



### 寻找页面JS事件

首先 先寻找 下面这个tab的event中的click有哪些操作，结果……

![js](https://i.loli.net/2019/05/25/5ce95ea9aec0834918.png)

那先去network中看看点击后发的包吧？会不会有什么请求，答案当然是有的！

![IERV4$P42ANN.png](https://i.loli.net/2019/05/25/5ce95f959d01734386.png)

这些是这个请求中提交的form data部分的内容，然后我反向搜索了下这个提交的url地址，结果一步一步在js中搜到了具体请求操作函数位置

```javascript
function getHotNum2(lotEnCode, planCode, needflag, issueNo, backIndex) {
        var myparams1 = {
            lotCode: lotEnCode,
            planCode: planCode,
            issueNo: issueNo,
            backIndex: backIndex,
            needTimes: needflag
        };

        var params1 = f_endparams(v_token(), myparams1);
        var thisurl1 = server_url + api.get_HotNumbers;
        var hot_ballbox = '';
        f_publicAjax(thisurl1, params1, true, function(data) {
            if (data.status != 0) {
                if (data.status == 26001021) {
                    window.wxc.xcConfirm(data.msg, 'warning');
                    return;
                } else if (data.status == 26001032) {
                    var option = {
                        btn: parseInt('0101', 2),
                        onOk: function() {}
                    };
                    window.wxc.xcConfirm('请先登录', 'warning', option);
                } else if (data.status == 100001) {
                    $('.noDate').show();
                    $('.forecast-result,.hot-ball,.hot-table').hide();
                    window.wxc.xcConfirm('精算中心暂无数据', 'warning');
                    return;
                } else {
                    window.wxc.xcConfirm(data.msg, 'warning');
                }
                window.wxc.xcConfirm(data.msg, 'warning');
            } else {
                if (JSON.stringify(data.data) == '{}') {
                    window.wxc.xcConfirm('精算中心暂无数据', 'warning');
                    return;
                }
                $('.tab-both').show();
                $('.noDate').hide();
                $('.hot-query').show();
                $('.hot-ball,.hot-table').show();
                $('.forecast-result').hide();
                $('[name=lottery-periods]').text(data.data.issueNo);
                if (data.data.issueNo >= parseInt($('[name=lottery-periods1]').text()) + 1) {
                    $('[name=nextIssue]').hide();
                } else {
                    $('[name=nextIssue]').show();
                }
                $('.hot-table-num,.hot-table-block').css('min-width', 'auto');
                $('.forecast-result').hide();
                $('.hot-query,.hot-query .secondPlace').show();
                var lotDvnCont = data.data.lotDvnCont;
                var hoList = [],
                    Multiple;
                for (var j = 0; j < lotDvnCont.length; j++) {
                    hoList.push(lotDvnCont[j].hot);
                }

                var maxInNumbers = Math.max.apply(Math, hoList); //获取最大值
                console.log(maxInNumbers);
                Multiple = 750 / maxInNumbers;
                for (var j = 0; j < lotDvnCont.length; j++) {
                    if(LotNum !== '10041' && LotNum !== '10045' && LotNum !== '10043' && LotNum !== '10044' && LotNum !== '10007'
                        && LotNum !== '10026' && LotNum !== '10027' && LotNum !== '10028' && LotNum !== '10029' && LotNum !== '10030'
                        && LotNum !== '10031' && LotNum !== '10032' && LotNum !== '10033' && LotNum !== '10002' && LotNum !== '10003'
                        && LotNum !== '10004'){   // 开奖号码不带0
                        lotDvnCont[j].number = lotDvnCont[j].number >= 10 ? lotDvnCont[j].number : '0'+ lotDvnCont[j].number;
                    }
                    hot_ballbox += '<li><div class="col-block" data-progress="' + Multiple * lotDvnCont[j].hot + '"><a class="circle-red hot-circle">' + lotDvnCont[j].number + '</a><h2 class="hotData">' + lotDvnCont[j].hot + '</h2></div></li>';
                }
                $('#hotBox').html(hot_ballbox);
                var colblockList = $('.col-block');
                for (var k = 0; k < colblockList.length; k++) {
                    var colblockListWidth = $(colblockList[k]).attr('data-progress');
                    var colblockListWidthInt = parseInt(colblockListWidth) + 28;
                    $(colblockList[k]).css('width', colblockListWidthInt + 'px');
                }
                var hotNum = $('#hotNum li').length;
                var lotName = $('[name=lotName]').attr('lotEnCode');
                var width = hotNum * 103 + 'px';
                $('.hot-table-num,.hot-table-block').css('min-width', width);
                if(data.data.planCode == 'POS2_HOT' && (data.data.lotCode == 'CN_F2B' || data.data.lotCode == 'SU_DLT')){
                    $('.hot-table-right ul li .col-block, .num-right ul li a').css('background','#CCE0FF');
                    $('.hot-table-right ul li a').css('background','#589BFF');
                    $('.hot-table-right ul li .hotData, .hot-table-right ul li .noHotData').css('color','#808080');
                }else{
                    $('.hot-table-right ul li .col-block, .num-right ul li a').css('background','#FFA6AC');
                }
            }
        });
    }
```

